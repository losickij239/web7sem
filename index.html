<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css" type="text/css"/>
    <script src="./doT.min.js" type="text/javascript"></script>
    <script id="pagetmpl" type="text/x-dot-template">
        <h2>Weather in city {{=it.city}}</h2>
        <p>Temperature: {{=it.temp}} ˚C</p>
        <p>Wind Speed: {{=it.windSpeed}} m/s</p>
        <p>Sky status: {{=it.sky}} </p>
        <p>Pressure: {{=it.pressure}} hPa </p>
        <p>Humidity: {{=it.humidity}} % </p>
    </script>
</head>

<body>

<div class="inputForm">
    <p class="city">Город <input type="text" id="userCity" class="textbox"/></p>
    <input class="button" type="button" value="Узнать погоду!" onclick="getWeather();"/>
</div>

<div id="content"></div>
</body>

<script type="text/javascript">
    document.getElementById("userCity")
        .addEventListener("keyup", function(event) {
            event.preventDefault();
            if (event.keyCode === 13) {
               getWeather();
            }
        });

function getWeather() {
    var enteredCity = document.getElementById('userCity').value;

    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'http://api.openweathermap.org/data/2.5/weather?q='+enteredCity+'&appid=3c6464a2f6bcbeecf2f55441edb741ce', false);
    //xhr.open('GET', 'mock.json', false);
    xhr.send();

    if (xhr.status != 200) {
        alert(xhr.status + ': ' + xhr.statusText); // пример вывода: 404: Not Found
    } else {
        var response = JSON.parse(xhr.responseText);
    }

    var data = {};
    data.city = response.name;
    data.temp = (response.main.temp - 273.15).toFixed(2);
    data.windSpeed = response.wind.speed;
    data.sky = response.weather[0].description;
    data.pressure = response.main.pressure;
    data.humidity = response.main.humidity;

    var pagefn = doT.template(document.getElementById('pagetmpl').text, undefined);
    document.getElementById('content').innerHTML = pagefn(data);
}
</script>

</html>
